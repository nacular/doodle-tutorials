<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-todo" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Todo | Doodle Tutorials</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-rh="true" name="twitter:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-rh="true" property="og:url" content="https://nacular.github.io/doodle-tutorials/docs/todo"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:image:width" content="380"><meta data-rh="true" name="og:image:height" content="78"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Todo | Doodle Tutorials"><meta data-rh="true" name="description" content="This tutorial shows how you might build the TodoMVC app using Doodle. This version deviates from the official app spec in that (like all Doodle apps) it does not use CSS or HTML directly. Therefore, it does not include the assets provided by the official spec. Instead, it replicates the UX with Doodle primitives."><meta data-rh="true" property="og:description" content="This tutorial shows how you might build the TodoMVC app using Doodle. This version deviates from the official app spec in that (like all Doodle apps) it does not use CSS or HTML directly. Therefore, it does not include the assets provided by the official spec. Instead, it replicates the UX with Doodle primitives."><link data-rh="true" rel="icon" href="/doodle-tutorials/img/favicon.png"><link data-rh="true" rel="canonical" href="https://nacular.github.io/doodle-tutorials/docs/todo"><link data-rh="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/todo" hreflang="en"><link data-rh="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/todo" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KN5YH7BJYG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KN5YH7BJYG",{anonymize_ip:!0})</script>



<script src="https://unpkg.com/kotlin-playground@1"></script><link rel="stylesheet" href="/doodle-tutorials/assets/css/styles.8934ba38.css">
<script src="/doodle-tutorials/assets/js/runtime~main.43e850ce.js" defer="defer"></script>
<script src="/doodle-tutorials/assets/js/main.2c8e2dcd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doodle-tutorials/"><div class="navbar__logo"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nacular/doodle-tutorials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://kotlinlang.slack.com/messages/doodle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Slack channel"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/timedcards">Timed Cards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/tabstrip">Animating Tab Strip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/contacts">Contacts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/calculator">Calculator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/doodle-tutorials/docs/todo">Todo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photos">Photos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photostream">Photo Stream</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1><a href="https://github.com/nacular/doodle-tutorials/tree/master/Todo" target="_blank" rel="noopener noreferrer">Todo</a> Tutorial</h1>
<p>This tutorial shows how you might build the <a href="http://todomvc.com" target="_blank" rel="noopener noreferrer">TodoMVC</a> app using Doodle. This version deviates from the official app spec in that (like all Doodle apps) it does not use CSS or HTML directly. Therefore, it does not include the assets provided by the official spec. Instead, it replicates the UX with Doodle primitives.</p>
<p>This version is also designed to work well as an embedded app. The version below (unlike the full-screen version) does not use routing for the filters. This means there is no way to deep-link to a filter, like the full-screen version has. The launch code decides this by injecting a different strategy for creating the filter buttons, while the app itself is unaware of this difference.</p>
<div class="doodle_u3ra"><div style="position:relative;height:700px"></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can also see the full-screen app here: <a href="https://nacular.github.io/doodle-tutorials/todo" target="_blank" rel="noopener noreferrer">JavaScript</a>, <a href="https://nacular.github.io/doodle-tutorials/todo_wasm" target="_blank" rel="noopener noreferrer">WebAssembly</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-setup">Project Setup<a href="#project-setup" class="hash-link" aria-label="Direct link to Project Setup" title="Direct link to Project Setup">​</a></h2>
<p>We will use a multi-platform library setup for this app, with a multiplatform launcher that depends on it. This is not necessary to use Doodle. You could create a single multiplatform build with the common parts of your app in <code>commonMain</code> etc.. This setup is used here because these apps are also launched by an app within <code>DocApps</code> when embedding them like below. Therefore, we need a pure library for each app. This is why there is an app and a runner.</p>
<!-- -->
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Todo</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TodoRunner</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Todo/build.gradle.kts" target="_blank" rel="noopener noreferrer"><strong>build.gradle.kts</strong></a></p><code theme="darcula" mode="kotlin" data-highlight-only="true">plugins {
    kotlin(&quot;multiplatform&quot;          )
    alias(libs.plugins.serialization)
}

kotlin {
    // Defined in buildSrc/src/main/kotlin/Common.kt
    jsTargets    ()
    wasmJsTargets()
    jvmTargets   ()

    sourceSets {
        commonMain.dependencies {
            api(libs.coroutines.core   )
            api(libs.serialization.json)

            api(libs.doodle.themes     )
            api(libs.doodle.controls   )
        }

        jsTest.dependencies {
            implementation(kotlin(&quot;test-js&quot;))
        }

        jvmTest.dependencies {
            implementation(kotlin(&quot;test-junit&quot;))
            implementation(libs.bundles.test.libs)
        }
    }
}</code></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/TodoRunner/build.gradle.kts" target="_blank" rel="noopener noreferrer"><strong>build.gradle.kts</strong></a></p><code theme="darcula" mode="kotlin" data-highlight-only="true">plugins {
    kotlin(&quot;multiplatform&quot;)
    application
}

kotlin {
    jsTargets    (executable = true)
    wasmJsTargets(executable = true)
    jvmTargets   (                 )

    sourceSets {
        commonMain.dependencies {
            implementation(project(&quot;:Todo&quot;))
        }

        jsMain.dependencies {
            implementation(libs.doodle.browser)
        }

        val wasmJsMain by getting {
            dependencies {
                implementation(libs.doodle.browser)
            }
        }

        jvmMain.dependencies {
            when (osTarget()) {
                &quot;macos-x64&quot;     -&gt; implementation(libs.doodle.desktop.jvm.macos.x64    )
                &quot;macos-arm64&quot;   -&gt; implementation(libs.doodle.desktop.jvm.macos.arm64  )
                &quot;linux-x64&quot;     -&gt; implementation(libs.doodle.desktop.jvm.linux.x64    )
                &quot;linux-arm64&quot;   -&gt; implementation(libs.doodle.desktop.jvm.linux.arm64  )
                &quot;windows-x64&quot;   -&gt; implementation(libs.doodle.desktop.jvm.windows.x64  )
                &quot;windows-arm64&quot; -&gt; implementation(libs.doodle.desktop.jvm.windows.arm64)
            }
        }
    }
}

application {
    mainClass.set(&quot;MainKt&quot;)
}

installFullScreenDemo(&quot;Development&quot;)
installFullScreenDemo(&quot;Production&quot; )</code></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Build uses <a href="https://github.com/nacular/doodle-tutorials/blob/master/gradle/libs.versions.toml" target="_blank" rel="noopener noreferrer">libs.versions.toml</a> file.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-our-application">Defining Our Application<a href="#defining-our-application" class="hash-link" aria-label="Direct link to Defining Our Application" title="Direct link to Defining Our Application">​</a></h2>
<p>All Doodle apps must implement the <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer"><code>Application</code></a> interface. The framework will then initialize our app via the constructor.</p>
<p>Doodle apps can be defined in <code>commonMain</code>, since they do not require any platform-specific dependencies. Therefore, we will do the same and place ours in <code>commonMain/kotlin/io/nacular/doodle/examples</code>.</p>
<p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Todo/src/commonMain/kotlin/io/nacular/doodle/examples/TodoApp.kt#L11" target="_blank" rel="noopener noreferrer"><strong>TodoApp.kt</strong></a></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.application.Application
import io.nacular.doodle.controls.IndexedItem
import io.nacular.doodle.controls.buttons.Button
import io.nacular.doodle.controls.buttons.HyperLink
import io.nacular.doodle.controls.itemVisualizer
import io.nacular.doodle.controls.list.MutableList
import io.nacular.doodle.controls.list.listEditor
import io.nacular.doodle.controls.panels.ScrollPanel
import io.nacular.doodle.controls.text.Label
import io.nacular.doodle.controls.theme.CommonLabelBehavior
import io.nacular.doodle.core.Behavior
import io.nacular.doodle.core.Container
import io.nacular.doodle.core.Display
import io.nacular.doodle.core.View
import io.nacular.doodle.core.container
import io.nacular.doodle.drawing.Canvas
import io.nacular.doodle.drawing.Color
import io.nacular.doodle.drawing.Color.Companion.Black
import io.nacular.doodle.drawing.Color.Companion.Transparent
import io.nacular.doodle.drawing.Color.Companion.White
import io.nacular.doodle.drawing.Font
import io.nacular.doodle.drawing.Font.Style.Italic
import io.nacular.doodle.drawing.FontLoader
import io.nacular.doodle.drawing.PatternPaint
import io.nacular.doodle.drawing.Stroke
import io.nacular.doodle.drawing.TextMetrics
import io.nacular.doodle.drawing.height
import io.nacular.doodle.drawing.opacity
import io.nacular.doodle.drawing.paint
import io.nacular.doodle.drawing.rect
import io.nacular.doodle.event.PointerListener.Companion.released
import io.nacular.doodle.examples.DataStore.DataStoreListModel
import io.nacular.doodle.examples.DataStore.Filter
import io.nacular.doodle.examples.DataStore.Filter.Active
import io.nacular.doodle.examples.DataStore.Filter.Completed
import io.nacular.doodle.focus.FocusManager
import io.nacular.doodle.geometry.Point
import io.nacular.doodle.geometry.Rectangle
import io.nacular.doodle.geometry.Size
import io.nacular.doodle.image.Image
import io.nacular.doodle.image.ImageLoader
import io.nacular.doodle.layout.Insets
import io.nacular.doodle.layout.constraints.Strength.Companion.Strong
import io.nacular.doodle.layout.constraints.constrain
import io.nacular.doodle.layout.constraints.fill
import io.nacular.doodle.theme.ThemeManager
import io.nacular.doodle.theme.adhoc.DynamicTheme
import io.nacular.doodle.theme.basic.list.BasicListBehavior
import io.nacular.doodle.theme.basic.list.BasicVerticalListPositioner
import io.nacular.doodle.theme.basic.list.TextEditOperation
import io.nacular.doodle.theme.basic.list.basicItemGenerator
import io.nacular.doodle.theme.native.NativeHyperLinkStyler
import io.nacular.doodle.utils.Dimension.Height
import io.nacular.doodle.utils.Encoder
import io.nacular.doodle.utils.diff.Delete
import io.nacular.doodle.utils.diff.Insert
import kotlinx.coroutines.CoroutineDispatcher
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.SupervisorJob
import kotlinx.coroutines.launch
import kotlin.Result.Companion.success
import kotlin.math.min

/**
 * This app is designed to run both top-level and nested. The filter buttons use hyperlinks in the spec,
 * but we will delegate their definition to the app creator to allow a different approach when nested
 * (i.e. using buttons instead of hyperlinks).
 *
 * The app will then use this provider to create the filter buttons.
 */
interface FilterButtonProvider {
    operator fun invoke(text: String, filter: Filter? = null, behavior: Behavior&lt;Button&gt;): Button
}

/**
 * Default implementation intended for use when app is top-level. It handles routing and provides
 * hyperlinks for the filter buttons.
 */
class LinkFilterButtonProvider(private val dataStore: DataStore, router: Router, private val linkStyler: NativeHyperLinkStyler): FilterButtonProvider {
    init {
        router[&quot;/&quot;         ] = { dataStore.filter = null      }
        router[&quot;/active&quot;   ] = { dataStore.filter = Active    }
        router[&quot;/completed&quot;] = { dataStore.filter = Completed }
        router.fireAction()
    }

    override fun invoke(text: String, filter: Filter?, behavior: Behavior&lt;Button&gt;): Button {
        val url = when (filter) {
            Active    -&gt; &quot;#/active&quot;
            Completed -&gt; &quot;#/completed&quot;
            else      -&gt; &quot;#/&quot;
        }

        return HyperLink(url = url, text = text).apply {
            this.behavior            = linkStyler(this, behavior) as Behavior&lt;Button&gt;
            this.acceptsThemes       = false
            dataStore.filterChanged += { rerender() }
        }
    }
}

/**
 * General styling config
 */
data class TodoConfig(
    val listFont              : Font,
    val titleFont             : Font,
    val lineColor             : Color  = Color(0xEDEDEDu),
    val filterFont            : Font,
    val footerFont            : Font,
    val headerColor           : Color  = Color(0xAF2F2Fu) opacity 0.15f,
    val deleteColor           : Color  = Color(0xCC9A9Au),
    val appBackground         : Color  = Color(0xF5F5F5u),
    val boldFooterFont        : Font,
    val selectAllColor        : Color  = Color(0x737373u),
    val checkForeground       : Image,
    val checkBackground       : Image,
    val placeHolderFont       : Font,
    val placeHolderText       : String = &quot;What needs to be done?&quot;,
    val placeHolderColor      : Color  = Color(0xE6E6E6u),
    val labelForeground       : Color  = Color(0x4D4D4Du),
    val footerForeground      : Color  = Color(0xBFBFBFu),
    val deleteHoverColor      : Color  = Color(0xAF5B5Eu),
    val taskCompletedColor    : Color  = Color(0xD9D9D9u),
    val clearCompletedText    : String = &quot;Clear completed&quot;,
    val textFieldBackground   : Color  = White,
    val filterButtonForeground: Color  = Color(0x777777u),
)

/**
 * A [TextEditOperation] that translates a String to a [Task]. It also customizes the textField to fit the app&#x27;s styling
 */
private class TaskEditOperation(focusManager: FocusManager?, list: MutableList&lt;Task, *&gt;, task: Task, current: View): TextEditOperation&lt;Task&gt;(focusManager, TaskEncoder(task.completed), list, task, current) {
    private class TaskEncoder(private val completed: Boolean = false): Encoder&lt;Task, String&gt; {
        override fun decode(b: String) = success(Task(b, completed))
        override fun encode(a: Task  ) = success(a.text)
    }

    init {
        textField.fitText         = emptySet()
        textField.backgroundColor = Transparent
    }

    override fun invoke() = container {
        children += textField
        layout    = constrain(textField) { it.edges eq parent.edges + Insets(top = 1.0, left = 58.0, bottom = 1.0) }
    }
}

/**
 * This is the main view of the app. It contains all the visual elements.
 *
 * @property config that provides styling and resources (i.e. font, images)
 * @property dataStore that tracks the overall state of tasks
 * @property linkStyler used to wrap our custom Hyperlink Behavior in a native one so we get the default link behavior as well
 * @property textMetrics used to measure text
 * @property focusManager used to control focus in the app
 * @property filterButtonProvider used to create the filter buttons
 */
private class TodoView(private val config              : TodoConfig,
                       private val dataStore           : DataStore,
                       private val linkStyler          : NativeHyperLinkStyler,
                       private val textMetrics         : TextMetrics,
                       private val focusManager        : FocusManager,
                       private val filterButtonProvider: FilterButtonProvider): View() {

    init {
        val header = Label(&quot;todos&quot;).apply {
            font            = config.titleFont
            behavior        = CommonLabelBehavior(textMetrics)
            acceptsThemes   = false
            foregroundColor = config.headerColor
        }
        lateinit var list: View
        val footer   = Footer(textMetrics, linkStyler, config)
        val taskList = object: Container() {
            init {
                clipCanvasToBounds = false

                // Maps tasks to TaskRow and updates them when recycled
                val visualizer = itemVisualizer&lt;Task, IndexedItem&gt; { item, previous, _ -&gt;
                    when (previous) {
                        is TaskRow -&gt; previous.also { it.task = item }
                        else       -&gt; TaskRow(config, dataStore, item)
                    }
                }

                // List containing Tasks. It is mutable since items can be edited
                list = MutableList(DataStoreListModel(dataStore), itemVisualizer = visualizer, fitContent = setOf(Height)).apply {
                    val rowHeight = 58.0
                    font          = config.listFont
                    cellAlignment = fill
                    editor        = listEditor { list, row, _, current -&gt; TaskEditOperation(focusManager, list, row, current) }
                    behavior      = BasicListBehavior(focusManager,
                        basicItemGenerator {
                            // edit when double-clicked
                            pointerChanged += released { event -&gt;
                                if (event.clickCount &gt;= 2) { this@apply.startEditing(index).also { event.consume() } }
                            }
                        },
                        BasicVerticalListPositioner(rowHeight),
                        PatternPaint(Size(10.0, rowHeight)) {
                            rect(Rectangle(size = this.size), color = White)
                            line(Point(y = 1), Point(10, 1), Stroke(config.lineColor))
                        },
                    )

                    itemsChanged += { _, differences -&gt;
                        // Scroll when a single item added
                        var numAdded    = 0
                        var numRemoved  = 0
                        var indexInList = 0

                        differences.forEach {
                            when (it) {
                                is Insert -&gt; {
                                    if (it.items.size &gt; 1) {
                                        return@forEach
                                    }

                                    ++numAdded
                                    ++indexInList
                                }
                                is Delete -&gt; {
                                    numRemoved += it.items.size
                                }
                                else      -&gt; indexInList += it.items.size
                            }
                        }

                        if (numAdded == 1 &amp;&amp; numRemoved &lt;= 1) {
                            scrollTo(indexInList)
                        }
                    }

                    boundsChanged += { _, old, new -&gt;
                        if (old.width != new.width || old.height != new.height) {
                            this@TodoView.relayout()
                        }
                    }
                }

                children += listOf(
                    TaskCreationBox(focusManager, textMetrics, config, dataStore),
                    ScrollPanel    (list).apply { contentWidthConstraints = { it eq width - verticalScrollBarWidth } },
                    FilterBox      (config, dataStore, textMetrics, filterButtonProvider)
                )

                layout = constrain(children[0], children[1], children[2]) { input, panel, filter -&gt;
                    listOf(input, panel, filter).forEach { it.width eq parent.width }
                    input.top     eq 0
                    input.height.preserve
                    panel.top     eq input.bottom

                    if (children[2].visible) {
                        filter.top    eq panel.bottom
                        filter.bottom eq parent.bottom
                        filter.height.preserve
                    }
                }
            }

            override fun render(canvas: Canvas) {
                canvas.outerShadow(vertical =  2.0, blurRadius =  4.0, color = Black opacity 0.2f) {
                    outerShadow   (vertical = 25.0, blurRadius = 50.0, color = Black opacity 0.1f) {
                        // Create stacked effect
                        if (!dataStore.isEmpty) {
                            rect(bounds.atOrigin.inset(Insets(top = height, left = 8.0, right = 8.0, bottom = -8.0)), color = White)
                            rect(bounds.atOrigin.inset(Insets(top = height, left = 4.0, right = 4.0, bottom = -4.0)), color = White)
                        }
                        rect(bounds.atOrigin, color = White)
                    }
                }
            }
        }

        children += listOf(header, taskList, footer)

        list.boundsChanged += { _,_,_ -&gt; doLayout() }

        layout = constrain(header, taskList, footer) { header, body, footer -&gt;
            listOf(header, body, footer).forEach { it.centerX eq parent.centerX }
            header.top    eq        9
            header.height.preserve

            val minHeight = taskList.children[0].height + (taskList.children[2].takeIf { it.visible }?.height ?: 0.0)

            body.top    eq header.bottom + 5
            body.width  eq min(550.0, parent.width - 10)
            body.height eq minHeight + list.height

            footer.top   eq body.bottom + 65
            footer.width eq body.width
            footer.height.preserve
            (footer.bottom lessEq parent.bottom) .. Strong
        }
    }
}

/**
 * Todo App based on TodoMVC
 */
class TodoApp(display             : Display,
              uiDispatcher        : CoroutineDispatcher,
              fonts               : FontLoader,
              theme               : DynamicTheme,
              themes              : ThemeManager,
  private val images              : ImageLoader,
              dataStore           : DataStore,
              linkStyler          : NativeHyperLinkStyler,
              textMetrics         : TextMetrics,
              focusManager        : FocusManager,
              filterButtonProvider: FilterButtonProvider): Application {
//sampleStart
    init {
        val appScope = CoroutineScope(SupervisorJob() + Dispatchers.Default)

        // Launch coroutine to fetch fonts/images
        appScope.launch(uiDispatcher) {
            val titleFont  = fonts            { size = 100; weight = 100; families = listOf(&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, &quot;Arial&quot;, &quot;sans-serif&quot;) }!!
            val listFont   = fonts(titleFont) { size =  24 }!!
            val footerFont = fonts(titleFont) { size =  10 }!!
            val config     = TodoConfig(
                listFont        = listFont,
                titleFont       = titleFont,
                footerFont      = footerFont,
                filterFont      = fonts(titleFont ) { size   = 14     }!!,
                boldFooterFont  = fonts(footerFont) { weight = 400    }!!,
                placeHolderFont = fonts(listFont  ) { style  = Italic }!!,
                checkForeground = checkForegroundImage(),
                checkBackground = checkBackgroundImage(),
            )

            // install theme
            themes.selected = theme

            display += TodoView(config, dataStore, linkStyler, textMetrics, focusManager, filterButtonProvider)

            display.layout = constrain(display.children[0]) { it.edges eq parent.edges }

            display.fill(config.appBackground.paint)
        }
    }
//sampleEnd

    override fun shutdown() {}

    private suspend fun checkForegroundImage() = images.load(&quot;data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23bddad5%22%20stroke-width%3D%223%22/%3E%3Cpath%20fill%3D%22%235dc2af%22%20d%3D%22M72%2025L42%2071%2027%2056l-4%204%2020%2020%2034-52z%22/%3E%3C/svg%3E&quot;)!!
    private suspend fun checkBackgroundImage() = images.load(&quot;data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23ededed%22%20stroke-width%3D%223%22/%3E%3C/svg%3E&quot;)!!
}</code>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Notice that <code>shutdown</code> is a no-op, since we don&#x27;t have any cleanup to do when the app closes.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-fullscreen-app">Creating A Fullscreen App<a href="#creating-a-fullscreen-app" class="hash-link" aria-label="Direct link to Creating A Fullscreen App" title="Direct link to Creating A Fullscreen App">​</a></h2>
<p>Doodle apps can be <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer">launched</a> in a few different ways. We create a helper to launch the app in <a href="https://nacular.github.io/doodle/docs/applications#top-level-apps" target="_blank" rel="noopener noreferrer">full screen</a>.</p>
<p><a href="https://github.com/nacular/doodle-tutorials/blob/master/TodoRunner/src/jsMain/kotlin/main.kt#L21" target="_blank" rel="noopener noreferrer"><strong>main.kt</strong></a></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.application.Modules.Companion.FontModule
import io.nacular.doodle.application.Modules.Companion.ImageModule
import io.nacular.doodle.application.Modules.Companion.KeyboardModule
import io.nacular.doodle.application.Modules.Companion.PointerModule
import io.nacular.doodle.application.application
import io.nacular.doodle.coroutines.Dispatchers
import io.nacular.doodle.theme.basic.BasicTheme.Companion.basicLabelBehavior
import io.nacular.doodle.theme.native.NativeTheme.Companion.nativeHyperLinkBehavior
import io.nacular.doodle.theme.native.NativeTheme.Companion.nativeScrollPanelBehavior
import io.nacular.doodle.theme.native.NativeTheme.Companion.nativeTextFieldBehavior
import kotlinx.browser.window
import org.kodein.di.DI.Module
import org.kodein.di.bindSingleton
import org.kodein.di.instance

/**
 * Creates a [TodoApp]
 */
//sampleStart
fun main() {
    application(modules = listOf(
        FontModule,
        PointerModule,
        KeyboardModule,
        ImageModule,
        basicLabelBehavior(),
        nativeTextFieldBehavior(),
        nativeHyperLinkBehavior(),
        nativeScrollPanelBehavior(smoothScrolling = true),
        Module(name = &quot;AppModule&quot;) {
            bindSingleton&lt;PersistentStore&gt; { LocalStorePersistence() }
            bindSingleton { DataStore(instance()) }
            bindSingleton&lt;Router&gt; { TrivialRouter(window) }
            bindSingleton&lt;FilterButtonProvider&gt; { LinkFilterButtonProvider(instance(), instance(), instance()) }
        }
    )) {
        // load app
        TodoApp(
            display              = instance(),
            fonts                = instance(),
            theme                = instance(),
            themes               = instance(),
            images               = instance(),
            dataStore            = instance(),
            linkStyler           = instance(),
            textMetrics          = instance(),
            focusManager         = instance(),
            uiDispatcher         = Dispatchers.UI,
            filterButtonProvider = instance()
        )
    }
}
//sampleEnd</code>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Normally this would just be your <code>main</code> function. But <code>main</code> would prevent the app from being used as a library. Which is what happens to allow both an embedded (in the docs) and full-screen version.</p></div></div>
<p>Use the <code>application</code> function to launch top-level apps. It takes a list of modules, and a lambda that builds the app. This lambda is within a Kodein injection context, which means we can inject dependencies into our app via <code>instance</code>, <code>provider</code>, etc.</p>
<p>Notice that we have included several modules for our app. This includes one for fonts, pointer, keyboard, and several for various View <a href="https://nacular.github.io/doodle/docs/rendering/behaviors" target="_blank" rel="noopener noreferrer"><code>Behaviors</code></a> (i.e. <a href="https://nacular.github.io/doodle-api/browser/io.nacular.doodle.theme.native/-native-theme/-companion/native-text-field-behavior.html" target="_blank" rel="noopener noreferrer"><code>nativeTextFieldBehavior()</code></a>) which loads the native behavior for TextFields. We also define some bindings directly in a new module. These are items with no built-in module, or items that only exist in our app code.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check out Kodein to learn more about how it handles dependency injection.</p></div></div>
<p>The <code>application</code> function also takes an optional HTML element within which the app will be hosted. The app will be hosted in <code>document.body</code> if you do not specify an element.</p>
<p>App launching is the only part of our code that is platform-specific; since it is the only time we might care about an HTML element. It also helps support embedding apps into non-Doodle contexts.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="supporting-docs-embedding">Supporting Docs Embedding<a href="#supporting-docs-embedding" class="hash-link" aria-label="Direct link to Supporting Docs Embedding" title="Direct link to Supporting Docs Embedding">​</a></h2>
<p>These docs actually launch the app using a custom <code>main</code> with a slightly different set of inputs. The big difference is in <code>FilterButtonProvider</code> used. The docs inject a provider that creates <code>PushButton</code>s instead of <code>HyperLink</code>s for the filter controls. The app itself treats these the same. The end result is that the docs version does not use routing.</p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">
// Notice the element is provided for embedded version
application(root = element, modules = listOf(FontModule, PointerModule, KeyboardModule, basicLabelBehavior(),
        nativeTextFieldBehavior(), nativeHyperLinkBehavior(), nativeScrollPanelBehavior(smoothScrolling = true),
        Module(name = &quot;AppModule&quot;) {
            // ...


            // Different behavior for docs version
            bind&lt;FilterButtonProvider&gt;() with singleton { EmbeddedFilterButtonProvider(instance()) }
        }
)) {
    // load app just like full-screen
    TodoApp(instance(), instance(), instance(), instance(), instance(), instance(), instance(), instance(), instance(), instance())
}
</code></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doodle-tutorials/docs/calculator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Calculator</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doodle-tutorials/docs/photos"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Photos</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-setup" class="table-of-contents__link toc-highlight">Project Setup</a></li><li><a href="#defining-our-application" class="table-of-contents__link toc-highlight">Defining Our Application</a></li><li><a href="#creating-a-fullscreen-app" class="table-of-contents__link toc-highlight">Creating A Fullscreen App</a></li><li><a href="#supporting-docs-embedding" class="table-of-contents__link toc-highlight">Supporting Docs Embedding</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Nacular</div></div></div></footer></div>
</body>
</html>