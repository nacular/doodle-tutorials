<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-calculator" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Calculator | Doodle Tutorials</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-rh="true" name="twitter:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-rh="true" property="og:url" content="https://nacular.github.io/doodle-tutorials/docs/calculator"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:image:width" content="380"><meta data-rh="true" name="og:image:height" content="78"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Calculator | Doodle Tutorials"><meta data-rh="true" name="description" content="Calculator Tutorial"><meta data-rh="true" property="og:description" content="Calculator Tutorial"><link data-rh="true" rel="icon" href="/doodle-tutorials/img/favicon.png"><link data-rh="true" rel="canonical" href="https://nacular.github.io/doodle-tutorials/docs/calculator"><link data-rh="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/calculator" hreflang="en"><link data-rh="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/calculator" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KN5YH7BJYG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KN5YH7BJYG",{anonymize_ip:!0})</script>



<script src="https://unpkg.com/kotlin-playground@1"></script><link rel="stylesheet" href="/doodle-tutorials/assets/css/styles.59830250.css">
<script src="/doodle-tutorials/assets/js/runtime~main.58b3dc22.js" defer="defer"></script>
<script src="/doodle-tutorials/assets/js/main.07e0e7d6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doodle-tutorials/"><div class="navbar__logo"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nacular/doodle-tutorials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://kotlinlang.slack.com/messages/doodle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Slack channel"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/timedcards">Timed Cards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/tabstrip">Animating Tab Strip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/contacts">Contacts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/doodle-tutorials/docs/calculator">Calculator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/todo">Todo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photos">Photos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photostream">Photo Stream</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1><a class="inline-github-link" href="https://github.com/nacular/doodle-tutorials/tree/master/Calculator" target="_blank">Calculator Tutorial</a></h1>
<p>Our goal is to build the following calculator app using Doodle. This is a simple calculator that only performs addition, subtraction, multiplication, and division. It also supports negative values, decimals, and has a convenience function for converting to a percentage.</p>
<p>However, it does not have more advanced features, like parentheses, or other math operations. This means the implementation is simpler, and we can focus on the way Doodle is used instead of the complexity of the app itself. Play around with the calculator to get a feel for it.</p>
<div class="doodle_u3ra"><div style="position:relative;height:500px"></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can also see the full-screen apps here: <a href="https://nacular.github.io/doodle-tutorials/calculator" target="_blank" rel="noopener noreferrer">JavaScript</a>, <a href="https://nacular.github.io/doodle-tutorials/calculator_wasm" target="_blank" rel="noopener noreferrer">WebAssembly</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-setup">Project Setup<a href="#project-setup" class="hash-link" aria-label="Direct link to Project Setup" title="Direct link to Project Setup">​</a></h2>
<p>The app will use a Kotlin Multiplatform setup, which means we can run it on a range of targets supported by Doodle. The directory structure follows a fairly common layout, with common classes and resources in one source set and platform-specific items in their own.</p>
<!-- -->
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Directory Layout</div><div class="admonitionContent_BuS1"><div style="display:flex"><style data-emotion="css 13s4dk6">.css-13s4dk6{min-width:250px;}</style><div class="MuiBox-root css-13s4dk6"><style data-emotion="css 1q7nh3k">.css-1q7nh3k{padding:0;margin:0;list-style:none;outline:0;position:relative;}</style><ul role="tree" style="--TreeView-itemChildrenIndentation:12px" aria-multiselectable="false" class="MuiRichTreeView-root css-1q7nh3k"><style data-emotion="css ljgrlg">.css-ljgrlg{list-style:none;margin:0;padding:0;outline:0;}</style><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-expanded="true" aria-selected="true" id="-src" tabindex="0"><style data-emotion="css zgkbnr">.css-zgkbnr{padding:4px 8px;border-radius:4px;width:100%;box-sizing:border-box;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;cursor:pointer;-webkit-tap-highlight-color:transparent;}.css-zgkbnr:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-zgkbnr:hover{background-color:transparent;}}.css-zgkbnr.Mui-disabled{opacity:0.38;background-color:transparent;}.css-zgkbnr.Mui-focused{background-color:rgba(0, 0, 0, 0.12);}.css-zgkbnr.Mui-selected{background-color:rgba(25, 118, 210, 0.08);}.css-zgkbnr.Mui-selected:hover{background-color:rgba(25, 118, 210, 0.12);}@media (hover: none){.css-zgkbnr.Mui-selected:hover{background-color:rgba(25, 118, 210, 0.08);}}.css-zgkbnr.Mui-selected.Mui-focused{background-color:rgba(25, 118, 210, 0.2);}.css-zgkbnr .MuiTreeItem-iconContainer{width:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}.css-zgkbnr .MuiTreeItem-iconContainer svg{font-size:18px;}.css-zgkbnr .MuiTreeItem-label{width:100%;box-sizing:border-box;min-width:0;position:relative;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}.css-zgkbnr .MuiTreeItem-checkbox{padding:0;}</style><div class="MuiTreeItem-content css-zgkbnr Mui-expanded Mui-selected"><div class="MuiTreeItem-iconContainer"><style data-emotion="css q7mezt">.css-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TreeViewCollapseIconIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div><div class="MuiTreeItem-label">src</div></div><style data-emotion="css gadsb9">.css-gadsb9{margin:0;padding:0;padding-left:var(--TreeView-itemChildrenIndentation);}</style><style data-emotion="css 1eefoa2">.css-1eefoa2{height:0;overflow:hidden;-webkit-transition:height 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:height 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;height:auto;overflow:visible;margin:0;padding:0;padding-left:var(--TreeView-itemChildrenIndentation);}</style><ul class="MuiCollapse-root MuiCollapse-vertical MuiTreeItem-groupTransition MuiCollapse-entered css-1eefoa2" style="min-height:0px" role="group"><style data-emotion="css 15830to">.css-15830to{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;}</style><div class="MuiCollapse-wrapper MuiCollapse-vertical css-15830to"><style data-emotion="css 9vd5ud">.css-9vd5ud{width:100%;}</style><div class="MuiCollapse-wrapperInner MuiCollapse-vertical css-9vd5ud"><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-expanded="true" aria-selected="false" id="-src/commonMain" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr Mui-expanded"><div class="MuiTreeItem-iconContainer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TreeViewCollapseIconIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div><div class="MuiTreeItem-label">commonMain</div></div><ul class="MuiCollapse-root MuiCollapse-vertical MuiTreeItem-groupTransition MuiCollapse-entered css-1eefoa2" style="min-height:0px" role="group"><div class="MuiCollapse-wrapper MuiCollapse-vertical css-15830to"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical css-9vd5ud"><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-selected="false" id="-src/commonMain/kotlin" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"></div><div class="MuiTreeItem-label">kotlin</div></div></li><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-selected="false" id="-src/commonMain/resources" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"></div><div class="MuiTreeItem-label">resources</div></div></li></div></div></ul></li><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-expanded="false" aria-selected="false" id="-src/jsMain" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TreeViewExpandIconIcon"><path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></div><div class="MuiTreeItem-label">jsMain</div></div></li><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-expanded="false" aria-selected="false" id="-src/jvmMain" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TreeViewExpandIconIcon"><path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></div><div class="MuiTreeItem-label">jvmMain</div></div></li><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-expanded="false" aria-selected="false" id="-src/jvmTest" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TreeViewExpandIconIcon"><path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></div><div class="MuiTreeItem-label">jvmTest</div></div></li><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-expanded="false" aria-selected="false" id="-src/wasmJsMain" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TreeViewExpandIconIcon"><path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></div><div class="MuiTreeItem-label">wasmJsMain</div></div></li></div></div></ul></li><li class="MuiTreeItem-root css-ljgrlg" role="treeitem" aria-selected="false" id="-build.gradle.kts" tabindex="-1"><div class="MuiTreeItem-content css-zgkbnr"><div class="MuiTreeItem-iconContainer"></div><div class="MuiTreeItem-label">build.gradle.kts</div></div></li></ul></div><div style="margin-left:1em"><div value="src"><p>All source code and resources are located under the <code>src</code> directory.</p><p>The application logic itself is located in the common source set (<code>src/commonMain</code>), which means it is entirely reused for each platform. In fact, the same app is used unchanged (just targeting JS) within this documentation.</p></div><div value="src/commonMain" hidden=""><p>Source code and resources for that are usable for platforms are stored in <code>commonMain</code>. This app is designed to work on all platforms, so our app code and all logic is found under this directory.</p></div><div value="src/commonMain/kotlin" hidden=""><p>The <code>kotlin</code> directory is where all code for a platform resides. In this case, we have all the classes for our app including <code>CalculatorApp</code>, <code>Calculator</code>, <code>CalculatorButtonBehavior</code> and <code>NumberFormatter</code>.</p><p>All of these classes are platform agnostic and used by all targets. This makes our app work on any target Doodle supports.</p></div><div value="src/commonMain/resources" hidden=""><p>An app can have resources like fonts, images, etc. that it loads at runtime. This directory contains these resources.</p><p>In our case, we will be loading two fonts that we store here.</p></div><div value="src/jsMain" hidden=""><p>Source code and resources that are needed for Web (JS) target are stored in <code>jsMain</code>. Our app is platform agnostic except for the launch portion, which is located in the source below this directory.</p></div><div value="src/jsMain/kotlin" hidden=""><p>The Web launch portion of our app is located here in the program&#x27;s <code>main</code> function. The JS version uses a platform-specific <code>NumberFormatter</code> that is based on <code>Intl.NumberFormat</code>.</p></div><div value="src/jsMain/resources" hidden=""><p>Holds the <code>index.html</code> file that loads the generated JS file produced for the Web (JS) target.</p></div><div value="src/jvmMain" hidden=""><p>Source code and resources that are needed for Desktop (JVM) target are stored in <code>jvmMain</code>.</p></div><div value="src/jvmMain/kotlin" hidden=""><p>The Desktop launch portion of our app is located here in the program&#x27;s <code>main</code> function. This version uses a platform-specific <code>NumberFormatter</code> that is based on <code>java.text.NumberFormat</code>.</p></div><div value="src/jvmTest" hidden=""><p>Tests written for our <code>Calculator</code> that will be run on the JVM. These tests are here instead of in <code>commonTest</code> because they use Mockk, which only runs on the JVM.</p></div><div value="src/jvmTest/kotlin" hidden=""><p>Tests written for our <code>Calculator</code> that will be run on the JVM. These tests are here instead of in <code>commonTest</code> because they use Mockk, which only runs on the JVM.</p></div><div value="src/wasmJsMain" hidden=""><p>Source code and resources that are needed for Web (WASM) target are stored in <code>wasmJsMain</code>. Our app is platform agnostic except for the launch portion, which is located in the source below this directory.</p></div><div value="src/wasmJsMain/kotlin" hidden=""><p>The Web launch portion of our app is located here in the program&#x27;s <code>main</code> function. The WASM version uses a platform-specific <code>NumberFormatter</code> that is based on <code>Intl.NumberFormat</code>.</p></div><div value="src/wasmJsMain/resources" hidden=""><p>Holds the <code>index.html</code> file that loads the generated JS file produced for the Web (WASM) target.</p></div><div value="build.gradle.kts" hidden=""><p>The <code>build.gradle.kts</code> file defines how the app is configured and all its dependencies. The Calculator app uses a multi-platform configuration so it can run on all Doodle supported targets.</p></div></div></div></div></div>
<p>Doodle apps are built using gradle like other Kotlin apps. The build is controlled by the <code>build.gradle.kts</code> script in the root of the <code>Calculator</code> directory.</p>
<p><strong>build.gradle.kts</strong></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">@file:OptIn(ExperimentalWasmDsl::class)

import org.jetbrains.kotlin.gradle.targets.js.dsl.ExperimentalWasmDsl

//sampleStart
plugins {
    kotlin(&quot;multiplatform&quot;)
    application
}

kotlin {
    js     { browser { binaries.executable() } } // Web     (JS  ) executable
    wasmJs { browser { binaries.executable()     // Web     (WASM) executable
        applyBinaryen {}                         // Binary size optimization
    } }
    jvm    {                                     // Desktop (JVM ) executable
        compilations.all {
            kotlinOptions { jvmTarget = &quot;11&quot; }   // JVM 11 is needed for Desktop
        }
        withJava()
    }

    sourceSets {
        // Source set for all platforms
        commonMain.dependencies {
            api(libs.coroutines.core) // async resource loading (fonts, images, ...)
            api(libs.doodle.controls)
        }

        // Web (JS) platform source set
        jsMain.dependencies {
            implementation(libs.doodle.browser)
        }

        // Web (WASM) platform source set
        val wasmJsMain by getting {
            dependencies {
                implementation(libs.doodle.browser)
            }
        }

        // Desktop (JVM) platform source set
        jvmMain.dependencies {
            // helper to derive OS/architecture pair
            when (osTarget()) {
                &quot;macos-x64&quot;     -&gt; implementation(libs.doodle.desktop.jvm.macos.x64    )
                &quot;macos-arm64&quot;   -&gt; implementation(libs.doodle.desktop.jvm.macos.arm64  )
                &quot;linux-x64&quot;     -&gt; implementation(libs.doodle.desktop.jvm.linux.x64    )
                &quot;linux-arm64&quot;   -&gt; implementation(libs.doodle.desktop.jvm.linux.arm64  )
                &quot;windows-x64&quot;   -&gt; implementation(libs.doodle.desktop.jvm.windows.x64  )
                &quot;windows-arm64&quot; -&gt; implementation(libs.doodle.desktop.jvm.windows.arm64)
            }
        }

        // JVM tests source set
        jvmTest.dependencies {
            implementation(kotlin(&quot;test-junit&quot;))
            implementation(libs.bundles.test.libs)
        }
    }
}

// Desktop entry point
application {
    mainClass.set(&quot;io.nacular.doodle.examples.MainKt&quot;)
}
//sampleEnd

// could be moved to buildSrc, but kept here for clarity
fun osTarget(): String {
    val osName = System.getProperty(&quot;os.name&quot;)
    val targetOs = when {
        osName == &quot;Mac OS X&quot;       -&gt; &quot;macos&quot;
        osName.startsWith(&quot;Win&quot;  ) -&gt; &quot;windows&quot;
        osName.startsWith(&quot;Linux&quot;) -&gt; &quot;linux&quot;
        else                       -&gt; error(&quot;Unsupported OS: $osName&quot;)
    }

    val targetArch = when (val osArch = System.getProperty(&quot;os.arch&quot;)) {
        &quot;x86_64&quot;, &quot;amd64&quot; -&gt; &quot;x64&quot;
        &quot;aarch64&quot;         -&gt; &quot;arm64&quot;
        else              -&gt; error(&quot;Unsupported arch: $osArch&quot;)
    }

    return &quot;${targetOs}-${targetArch}&quot;
}</code>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The gradle build uses <a href="https://docs.gradle.org/current/userguide/version_catalogs.html" target="_blank" rel="noopener noreferrer">gradle version catalogs</a>; see <a href="https://github.com/nacular/doodle-tutorials/blob/master/gradle/libs.versions.toml" target="_blank" rel="noopener noreferrer">libs.versions.toml</a> file for library info.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-application">The Application<a href="#the-application" class="hash-link" aria-label="Direct link to The Application" title="Direct link to The Application">​</a></h2>
<p>All Doodle apps must implement the <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer"><code>Application</code></a> interface. The constructor is used as the app&#x27;s initialization entry point, and it is called as part of the <code>application</code> launch block. Doodle apps can be created in a platform agnostic way and placed into the <code>commonMain</code> source set so they are usable on multiple targets. This is how we will define the Calculator app.</p>
<p>This app will be fairly simple: just create an instance of our calculator and add it to the display.</p>
<p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/CalculatorApp.kt#L11" target="_blank" rel="noopener noreferrer"><strong>CalculatorApp.kt</strong></a></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">
package io.nacular.doodle.examples

// ...

class CalculatorApp(display: Display): Application {
  init {
      // creat and display a single Calculator
      display += Calculator()
  }

  override fun shutdown() { /* no-op */ }
}
</code>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Notice that <code>shutdown</code> is a no-op, since we don&#x27;t have any cleanup to do when the app closes.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="app-launcher">App Launcher<a href="#app-launcher" class="hash-link" aria-label="Direct link to App Launcher" title="Direct link to App Launcher">​</a></h2>
<p>Doodle apps can be <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer">launched</a> in a few different ways on Web and Desktop. Use the <code>application</code> function in a platform source-set (i.e. <code>jsMain</code>, <code>jvmMain</code>, etc.) to launch top-level apps. It takes a list of modules to load and a lambda that builds the app. This lambda is within a Kodein injection context, which means we can inject dependencies into our app via <code>instance</code>, <code>provider</code>, etc.</p>
<p><strong>main.kt</strong></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.application.Modules.Companion.FontModule
import io.nacular.doodle.application.Modules.Companion.PointerModule
import io.nacular.doodle.application.application
import org.kodein.di.instance

/**
 * Creates a [CalculatorApp]
 */
//sampleStart
fun main() {
    application(modules = listOf(FontModule, PointerModule)) {
        // load app
        CalculatorApp(
            display         = instance(),
            textMetrics     = instance(),
            fonts           = instance(),
            numberFormatter = NumberFormatterImpl()
        )
    }
}
//sampleEnd</code>
<p>Notice that we have included the <a href="https://nacular.github.io/doodle/docs/rendering/text#fonts" target="_blank" rel="noopener noreferrer"><code>FontModule</code></a> and <a href="https://nacular.github.io/doodle/docs/user_input/pointer" target="_blank" rel="noopener noreferrer"><code>PointerModule</code></a>. These are needed to enable font loading and pointer interactions. Our app will not directly know we loaded the <code>PointerModule</code>, but pointer related events will only work because we have.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check out <a href="https://github.com/kosi-libs/Kodein" target="_blank" rel="noopener noreferrer">Kodein</a> to learn more about how it handles dependency injection.</p></div></div>
<p>The <code>application</code> function also takes an optional HTML element (for Web targets) within which the app will be hosted. The app will be hosted in <code>document.body</code> if no element is specified.</p>
<p>App launching is the only part of our code that is platform-specific. This makes sense, since it is where we define concrete dependencies to pass into our app that can vary by platform. It is also where we control how our app runs, which is platform specific.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="calculator-view">Calculator View<a href="#calculator-view" class="hash-link" aria-label="Direct link to Calculator View" title="Direct link to Calculator View">​</a></h2>
<p>We will implement our calculator as a single <a href="https://nacular.github.io/doodle/docs/views" target="_blank" rel="noopener noreferrer"><code>View</code></a> that manages its state directly. This makes sense for simple use-cases, but might not be the right choice for larger apps.</p>
<p>This View will be broken into a hierarchy of views, with two top-level items: a custom <code>Output</code> and a <a href="https://nacular.github.io/doodle/docs/ui_components/overview#gridpanel" target="_blank" rel="noopener noreferrer"><code>GridPanel</code></a>.</p>
<div class="doodle_u3ra"><div style="position:relative;height:500px"></div></div>
<p>The <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L48" target="_blank" rel="noopener noreferrer"><strong>Output</strong></a> is a really simple <code>View</code> that tracks a number and its text representation, which it renders to the screen. It also exposes the number as the current &quot;answer&quot; on the calculator. Its most complex role is displaying the text with proper alignment and scaling to avoid any clipping.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Notice how the output text starts off center aligned with the operator buttons; and how it shrinks as the number grows beyond the screen size.</p></div></div>
<p>Take a look at the <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L48" target="_blank" rel="noopener noreferrer"><strong>Output</strong></a> class, and you will see it has a <code>text</code> property that it tracks the width of. It also uses <code>textTransform</code> to perform the text scaling.</p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">
private inner class Output: View() {
  //...

  // Transform used to scale text down as it grows beyond window width
  private var textTransform = Identity

  //...

  /** Text representation of number */
  var text = &quot;0&quot;
      set(new) {
          field = new
          val textWidth   = textMetrics.width(field, font)
          val windowWidth = width - inset * 2

          // use transform when text grows beyond window width
          textTransform = when {
              textWidth &gt; windowWidth -&gt; (windowWidth/textWidth).let { Identity.scale(x = it, y = it, around = Point(width / 2, height)) }
              else                    -&gt; Identity
          }

          rerender()
      }

  //...

  override fun render(canvas: Canvas) {
      val textPosition = textMetrics.size(text, font).let {
          val x = when {
              textTransform.isIdentity -&gt; width - it.width - inset
              else                     -&gt; (width - it.width) / 2
          }

          Point(x, height - it.height)
      }

      // scaling, if present, is applied to the canvas before text rendered
      canvas.transform(textTransform) {
          text(text, at = textPosition, font = font, color = foregroundColor ?: White)
      }
  }
}
</code>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-dependencies">More Dependencies<a href="#more-dependencies" class="hash-link" aria-label="Direct link to More Dependencies" title="Direct link to More Dependencies">​</a></h2>
<p>The <code>Output</code> class, and others in <code>Calculator</code> need things like fonts, and the ability to measure text. Doodle provides these capabilities via interfaces like <code>FontLoader</code> and <code>TextMetrics</code>. These are provided to <code>Calculator</code> via constructor injection. That results in a constructor as follows:</p>
<p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L35" target="_blank" rel="noopener noreferrer"><strong>Calculator.kt</strong></a></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">
class Calculator(
  private val fonts          : FontLoader,
              appScope       : CoroutineScope,
  private val textMetrics    : TextMetrics,
  private val numberFormatter: NumberFormatter
): View() {
}
</code>
<p>This means <code>CalculatorApp</code> needs to be updated as well. We continue by injecting these dependencies there.</p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.application.Application
import io.nacular.doodle.core.Display
import io.nacular.doodle.drawing.FontLoader
import io.nacular.doodle.drawing.TextMetrics
import io.nacular.doodle.layout.constraints.constrain
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.SupervisorJob

/**
 * Simple calculate app that places a [Calculator] at the center of the display.
 */
//sampleStart
class CalculatorApp(
    display        : Display,
    textMetrics    : TextMetrics,
    fonts          : FontLoader,
    numberFormatter: NumberFormatter
): Application {
    init {
        val appScope = CoroutineScope(SupervisorJob() + Dispatchers.Default)

        display += Calculator(fonts, appScope, textMetrics, numberFormatter).apply {
            sizePreferencesChanged += { _,_,_ -&gt;
                display.relayout()
            }
        }

        display.layout = constrain(display.children[0]) {
            it.width  eq (display.children.firstOrNull()?.idealSize?.width  ?: 0.0)
            it.height eq (display.children.firstOrNull()?.idealSize?.height ?: 0.0)
            it.center eq parent.center
        }
    }

    override fun shutdown() { /* no-op */ }
}
//sampleEnd</code>
<p>Now <code>main</code> needs to provide these, along with <code>Display</code>, when constructing the app.</p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.application.Modules.Companion.FontModule
import io.nacular.doodle.application.Modules.Companion.PointerModule
import io.nacular.doodle.application.application
import org.kodein.di.instance

/**
 * Creates a [CalculatorApp]
 */
//sampleStart
fun main() {
    application(modules = listOf(FontModule, PointerModule)) {
        // load app
        CalculatorApp(
            display         = instance(),
            textMetrics     = instance(),
            fonts           = instance(),
            numberFormatter = NumberFormatterImpl()
        )
    }
}
//sampleEnd</code>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Unlike <code>TextMetrics</code>, <code>FontLoader</code> and is not included in Doodle&#x27;s default modules, so we have to load it explicitly using the <a href="https://nacular.github.io/doodle/docs/rendering/text#fonts" target="_blank" rel="noopener noreferrer"><code>FontModule</code></a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-buttons">The Buttons<a href="#the-buttons" class="hash-link" aria-label="Direct link to The Buttons" title="Direct link to The Buttons">​</a></h2>
<p>We can manage the set of buttons within the calculator with a <a href="https://nacular.github.io/doodle/docs/ui_components/overview#gridpanel" target="_blank" rel="noopener noreferrer"><code>GridPanel</code></a>, which provides the kind of layout we need. This results in the following initialization for <code>Calculator</code>.</p>
<p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L35" target="_blank" rel="noopener noreferrer"><strong>Calculator.kt</strong></a></p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.controls.buttons.Button
import io.nacular.doodle.controls.buttons.ButtonGroup
import io.nacular.doodle.controls.buttons.PushButton
import io.nacular.doodle.controls.buttons.ToggleButton
import io.nacular.doodle.controls.panels.GridPanel
import io.nacular.doodle.core.Layout
import io.nacular.doodle.core.PositionableContainer
import io.nacular.doodle.core.View
import io.nacular.doodle.drawing.AffineTransform.Companion.Identity
import io.nacular.doodle.drawing.Canvas
import io.nacular.doodle.drawing.Color
import io.nacular.doodle.drawing.Color.Companion.Black
import io.nacular.doodle.drawing.Color.Companion.Darkgray
import io.nacular.doodle.drawing.Color.Companion.Lightgray
import io.nacular.doodle.drawing.Color.Companion.Orange
import io.nacular.doodle.drawing.Color.Companion.White
import io.nacular.doodle.drawing.FontLoader
import io.nacular.doodle.drawing.TextMetrics
import io.nacular.doodle.drawing.darker
import io.nacular.doodle.drawing.lighter
import io.nacular.doodle.drawing.rect
import io.nacular.doodle.drawing.text
import io.nacular.doodle.geometry.Point
import io.nacular.doodle.geometry.Size
import io.nacular.doodle.layout.constraints.constrain
import io.nacular.doodle.system.Cursor.Companion.Pointer
import io.nacular.doodle.utils.roundToNearest
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.launch
import kotlin.js.JsName
import kotlin.math.pow

/**
 * Simple calculator with basic math operations.
 *
 * @property fonts           used to find fonts
 * @param    appScope        used to run coroutines
 * @property textMetrics     used to measure text
 * @property numberFormatter used to display number output
 */
class Calculator(
    private val fonts          : FontLoader,
                appScope       : CoroutineScope,
    private val textMetrics    : TextMetrics,
    private val numberFormatter: NumberFormatter
): View() {
    // region ================ Helper Classes ==================================

    private inner class Output: View() {

        // Default width when input starts at `0`
        private val defaultWidth get() = textMetrics.width(&quot;0&quot;, font)

        // Text inset from the left/right edge of the output
        private val inset by lazy { (clear.width - defaultWidth) / 2 }

        // Transform used to scale text down as it grows beyond window width
        private var textTransform = Identity

        /** Numeric value of the output */
        var number = 0.0; set(new) {
            field = new
            text  = numberFormatter(number)
        }

        /** Text representation of [number] */
        var text = &quot;0&quot;; set(new) {
            field = new

            val textWidth   = textMetrics.width(field, font)
            val windowWidth = width - inset * 2

            // use transform when text grows beyond window width
            textTransform = when {
                textWidth &gt; windowWidth -&gt; (windowWidth/textWidth).let { Identity.scale(x = it, y = it, around = Point(width / 2, height)) }
                else                    -&gt; Identity
            }

            rerender()
        }

        init {
            foregroundColor = White
        }

        override fun render(canvas: Canvas) {
            val textPosition = textMetrics.size(text, font).let {
                val x = when {
                    textTransform.isIdentity -&gt; width - it.width - inset
                    else                     -&gt; (width - it.width) / 2
                }

                Point(x, height - it.height)
            }

            // scaling, if present, is applied to the canvas before text rendered
            canvas.transform(textTransform) {
                text(text, at = textPosition, font = font, color = foregroundColor ?: White)
            }
        }
    }

    inner class OperatorButton(text: String, background: Color = operatorColor, foreground: Color = White, private val method: Double.(Double) -&gt; Double): ToggleButton(text) {
        init {
            configure(this, background, foreground)

            fired += {
                compute()

                activeOperator = this
            }
        }

        internal operator fun invoke(left: Double, right: Double) = method(left, right)
    }

    // endregion

    // region ================ Colors ==================================

    private val numberColor   = Darkgray.darker(0.5f)
    private val operatorColor = Orange.lighter (0.1f)

    // endregion

    // region ================ Internal State ==================================

    private var activeOperator: OperatorButton? = null; set(new) {
        field = new

        when (field) {
            null -&gt; {
                div.selected  = false
                times.selected = false
                minus.selected = false
                plus.selected  = false
            }
        }
    }

    private var reset             = true                    // indicates when to begin a new operand
    private var negated           = false                   // tracks whether number is negative
    private var leftValue         = null as Double?         // left-side operand
    private var rightValue        = null as Double?         // right-side operand
    private var decimalPlace      = 0                       // tracks decimal place for fractions
    private var committedOperator = null as OperatorButton? // operator to be applied to left and right values

    // endregion

    // region ================ Visual Elements =================================

    private val output = Output()

    val result get() = output.number

    val div   = OperatorButton(&quot;÷&quot;, method = Double::div  )
    val times = OperatorButton(&quot;×&quot;, method = Double::times)
    val minus = OperatorButton(&quot;-&quot;, method = Double::minus)
    val plus  = OperatorButton(&quot;+&quot;, method = Double::plus )

    val clear = func(&quot;AC&quot; ).apply {
        fired += {
            output.number = 0.0
            clearInternalState()
        }
    }
    val negate = func(&quot;+/-&quot;).apply {
        fired += {
            if (reset) { output.number = 0.0 }

            reset   = false
            negated = !negated

            output.number *= -1
        }
    }

    val percent = func(&quot;%&quot;).apply {
        fired += {
            output.number *= 0.01
        }
    }
    val decimal = func(&quot;.&quot;, background = numberColor, foreground = White).apply {
        fired += {
            if (decimalPlace == 0) {
                if (reset) { output.number = 0.0 }

                reset        = false
                output.text += &quot;.&quot;   // bit of a hack/short-cut since the number formatter should be used
                decimalPlace = 1
            }
        }
    }

    val equal = func(&quot;=&quot;, operatorColor, White).apply {
        fired += {
            compute()
            clearInternalState()
        }
    }

    @JsName(&quot;nine&quot; ) val `9` = number(9)
    @JsName(&quot;eight&quot;) val `8` = number(8)
    @JsName(&quot;seven&quot;) val `7` = number(7)
    @JsName(&quot;six&quot;  ) val `6` = number(6)
    @JsName(&quot;five&quot; ) val `5` = number(5)
    @JsName(&quot;four&quot; ) val `4` = number(4)
    @JsName(&quot;three&quot;) val `3` = number(3)
    @JsName(&quot;two&quot;  ) val `2` = number(2)
    @JsName(&quot;one&quot;  ) val `1` = number(1)
    @JsName(&quot;zero&quot; ) val `0` = number(0)

    // endregion

    // region ================ Button Helpers ==================================

    private fun button(text: String, background: Color = operatorColor, foreground: Color = White) = configure(PushButton(text), background, foreground)
    private fun func  (text: String, background: Color = Lightgray,     foreground: Color = Black) = button(text, background, foreground)
    private fun number(number: Int                                                               ) = button(&quot;$number&quot;, background = numberColor).apply {
        fired += {
            committedOperator = activeOperator

            val newDigit = (if (negated) -1 else 1) * number.toDouble()

            output.number = when {
                reset             -&gt; number.toDouble()
                decimalPlace == 0 -&gt; output.number * 10 + newDigit
                decimalPlace &lt; 10 -&gt; {
                    val fraction = 1 / 10.0.pow(decimalPlace)

                    (output.number + newDigit * fraction).roundToNearest(fraction).also { ++decimalPlace }
                }
                else              -&gt; output.number
            }

            reset = false
        }
    }

    private fun configure(button: Button, background: Color, foreground: Color) = button.apply {
        size            = Size(60)
        cursor          = Pointer
        behavior        = CalcButtonBehavior(textMetrics)
        foregroundColor = foreground
        backgroundColor = background
    }

    // endregion

    /**
     * Computes the current value based on [leftValue], [rightValue], and [committedOperator].
     */
    private fun compute() {
        when {
            committedOperator != null -&gt; rightValue = output.number
            leftValue        == null  -&gt; leftValue  = output.number
        }

        committedOperator?.let { operator -&gt;
            leftValue?.let { left -&gt;
                rightValue?.let { right -&gt;
                    operator(left, right).also {
                        output.number = it
                        leftValue     = it
                        rightValue    = null
                    }
                    committedOperator = null
                }
            }
        }

        reset        = true
        decimalPlace = 0
    }

    /**
     * Resets all internal state, except [output].
     */
    private fun clearInternalState() {
        reset             = true
        negated           = false
        leftValue         = null
        rightValue        = null
        decimalPlace      = 0
        activeOperator    = null
        committedOperator = null
    }

    /**
     * Updates font for [output] and function buttons using different sizes and weights than the given [font].
     */
    private suspend fun loadFonts() {
        font = fonts(&quot;Roboto-Regular.ttf&quot;) {
            family = &quot;Roboto&quot;
            weight = 400
            size   = 32
        }

        font?.let { font -&gt;
            fonts(&quot;Roboto-Light.ttf&quot;) {
                family = &quot;Roboto&quot;
                size   = font.size - 5
                weight = 100
            }?.let { lightFont -&gt;
                output.font        = fonts(lightFont) { size = 72 }
                clear.font         = lightFont
                negate.font        = lightFont
                percent.font = lightFont
            }
        }
    }

//sampleStart
    init {
        appScope.launch {
            loadFonts()

            ButtonGroup(allowDeselectAll = true, buttons = arrayOf(div, times, minus, plus))

            val outputHeight  = 100.0
            val buttonSpacing =  10.0

            // Use GridPanel to hold all buttons
            val gridPanel = GridPanel().apply {
                add(clear, 0, 0); add(negate, 0, 1); add(percent, 0, 2); add(div,   0, 3)
                add(`7`,   1, 0); add(`8`,    1, 1); add(`9`,     1, 2); add(times, 1, 3)
                add(`4`,   2, 0); add(`5`,    2, 1); add(`6`,     2, 2); add(minus, 2, 3)
                add(`1`,   3, 0); add(`2`,    3, 1); add(`3`,     3, 2); add(plus,  3, 3)
                add(`0`,   4, 0,  columnSpan = 2  ); add(decimal, 4, 2); add(equal, 4, 3)

                rowSpacing    = { buttonSpacing }
                columnSpacing = { buttonSpacing }
            }

            // Add output and gridPanel to the Calculator view
            children += listOf(output, gridPanel)

            val insets = 10.0

            // Place Output outside grid so the height can be more easily controlled
            val constraints = constrain(output, gridPanel) { output, grid -&gt;
                output.top    eq insets
                output.left   eq insets
                output.right  eq parent.right - insets
                output.height eq outputHeight

                grid.top      eq output.bottom + buttonSpacing
                grid.left     eq output.left
                grid.right    eq output.right
                grid.bottom   eq parent.bottom - insets
            }

            layout = object: Layout by constraints {
                // Set total height to grid panel&#x27;s ideal width and height, plus output and spacing
                override fun idealSize(container: PositionableContainer, default: Size?) = gridPanel.idealSize?.let {
                    Size(it.width + 2 * insets, it.height + outputHeight + buttonSpacing + 2 * insets)
                }
            }

            // Force idealSize when gridPanel is laid out
            gridPanel.sizePreferencesChanged += { _,_,new -&gt;
                idealSize = new.idealSize?.let { Size(it.width + 2 * insets, it.height + outputHeight + buttonSpacing + 2 * insets) }
            }
        }
    }
//sampleEnd

    override fun render(canvas: Canvas) {
        canvas.rect(bounds.atOrigin, radius = 40.0, color = Black)
    }
}</code>
<p>The final initialization steps are:</p>
<ol>
<li>Load fonts</li>
<li>Setup buttons in <code>GridPanel</code></li>
<li>Add <code>Output</code> and <code>grid</code> as children</li>
<li>Configure the <code>layout</code></li>
</ol>
<p>This example uses non-standard/recommended property names for buttons to improve readability slightly. This also makes tests a little simpler to understand.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="button-styling">Button Styling<a href="#button-styling" class="hash-link" aria-label="Direct link to Button Styling" title="Direct link to Button Styling">​</a></h2>
<p>The calculator buttons come in a few different color schemes. But they all share the same <a href="https://nacular.github.io/doodle/docs/rendering/behaviors" target="_blank" rel="noopener noreferrer"><code>Behavior</code></a>, defined by <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/CalcButtonBehavior.kt#L16" target="_blank" rel="noopener noreferrer"><code>CalcButtonBehavior</code></a>. Buttons--like many Views--let you define their look-and-feel using a <code>Behavior</code>. Ours is fairly simple; it draws the rounded rectangle for the button background and centers the text above it. These are both managed with the right color based on the button&#x27;s state. It gets state tracking and text positioning for free via its base class: <code>CommonButtonBehavior</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-hit-detection">Custom Hit Detection<a href="#custom-hit-detection" class="hash-link" aria-label="Direct link to Custom Hit Detection" title="Direct link to Custom Hit Detection">​</a></h2>
<p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/CalcButtonBehavior.kt#L16" target="_blank" rel="noopener noreferrer"><code>CalcButtonBehavior</code></a> provides a rounded style for our buttons. But the default hit-detection for Views is tied to their rectangular bounds. We can fix this by writing custom pointer hit-detection in our behavior.</p>
<code theme="darcula" mode="kotlin" data-highlight-only="true">
class CalcButtonBehavior(textMetrics: TextMetrics): CommonTextButtonBehavior&lt;Button&gt;(textMetrics) {
  //...

  override fun contains(view: Button, point: Point): Boolean {
      val radius      = view.height / 2
      val leftCircle  = Circle(center = Point(view.x + radius,            view.center.y), radius = radius)
      val rightCircle = Circle(center = Point(view.bounds.right - radius, view.center.y), radius = radius)

      return when {
          point.x &lt; radius              -&gt; point in leftCircle
          point.x &gt; view.width - radius -&gt; point in rightCircle
          else                          -&gt; point in view.bounds
      }
  }
}
</code>
<p>The <code>contains(Button, Point)</code> method is called by <code>Button</code> to check whether the pointer is within its bounds. This logic ensures the pointer will only &quot;hit&quot; our button when it goes within the rounded rectangle.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The <code>contains</code> check provides a <code>Point</code> in the View&#x27;s <strong>parent&#x27;s</strong> coordinates.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h2>
<p>Doodle is designed to avoid platform specific dependencies except in the small amount of launch code. The <code>CalculatorApp</code> and <code>Calculator</code> are written in <code>commonMain</code>, which means we can test them by writing tests in <code>commonTest</code> and running them on each platform.</p>
<p>In our case, we will use the Mockk library for testing, which means we will actually only write tests for the JVM where that library works. Test speed is a big advantage of this setup, since there are no external dependencies.</p>
<p>The tests in <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/jvmTest/kotlin/io/nacular/doodle/examples/CalculatorTests.kt#L18" target="_blank" rel="noopener noreferrer"><code>CalculatorTests</code></a> are a bit contrived, but they illustrate how you might validate various parts of your app.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doodle-tutorials/docs/contacts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Contacts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doodle-tutorials/docs/todo"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Todo</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-setup" class="table-of-contents__link toc-highlight">Project Setup</a></li><li><a href="#the-application" class="table-of-contents__link toc-highlight">The Application</a></li><li><a href="#app-launcher" class="table-of-contents__link toc-highlight">App Launcher</a></li><li><a href="#calculator-view" class="table-of-contents__link toc-highlight">Calculator View</a></li><li><a href="#more-dependencies" class="table-of-contents__link toc-highlight">More Dependencies</a></li><li><a href="#the-buttons" class="table-of-contents__link toc-highlight">The Buttons</a></li><li><a href="#button-styling" class="table-of-contents__link toc-highlight">Button Styling</a></li><li><a href="#custom-hit-detection" class="table-of-contents__link toc-highlight">Custom Hit Detection</a></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Nacular</div></div></div></footer></div>
</body>
</html>