<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-photos">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Photos | Doodle Tutorials</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-rh="true" name="twitter:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-rh="true" property="og:url" content="https://nacular.github.io/doodle-tutorials/docs/photos"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:image:width" content="380"><meta data-rh="true" name="og:image:height" content="78"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Photos | Doodle Tutorials"><meta data-rh="true" name="description" content="We will build a simple photo app that lets you view and manipulate images using a pointer or multi-touch. Images will be added to the app via drag-drop. You can then move, size, and rotate them with a mouse, pointer, touch, or via an info overlay."><meta data-rh="true" property="og:description" content="We will build a simple photo app that lets you view and manipulate images using a pointer or multi-touch. Images will be added to the app via drag-drop. You can then move, size, and rotate them with a mouse, pointer, touch, or via an info overlay."><link data-rh="true" rel="icon" href="/doodle-tutorials/img/favicon.png"><link data-rh="true" rel="canonical" href="https://nacular.github.io/doodle-tutorials/docs/photos"><link data-rh="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/photos" hreflang="en"><link data-rh="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/photos" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KN5YH7BJYG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KN5YH7BJYG",{anonymize_ip:!0})</script>



<script src="https://unpkg.com/kotlin-playground@1"></script><link rel="stylesheet" href="/doodle-tutorials/assets/css/styles.f2d06e86.css">
<link rel="preload" href="/doodle-tutorials/assets/js/runtime~main.e6059f2d.js" as="script">
<link rel="preload" href="/doodle-tutorials/assets/js/main.1f062b3e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doodle-tutorials/"><div class="navbar__logo"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/doodle-tutorials/docs/introduction">Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nacular/doodle-tutorials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://kotlinlang.slack.com/messages/doodle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Slack channel"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/doodle-tutorials/"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/timedcards">Timed Cards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/tabstrip">Animating Tab Strip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/contacts">Contacts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/calculator">Calculator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/todo">Todo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/doodle-tutorials/docs/photos">Photos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photostream">Photo Stream</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1><a href="https://github.com/nacular/doodle-tutorials/tree/master/Photos" target="_blank" rel="noopener noreferrer">Photos</a> Tutorial</h1><p>We will build a simple photo app that lets you view and manipulate images using a pointer or multi-touch. Images will be added to the app via drag-drop. You can then move, size, and rotate them with a mouse, pointer, touch, or via an info overlay.</p><p>Here is the end result.</p><div functionname="photos" height="700"></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>You can also see the full-screen app <a href="https://nacular.github.io/doodle-tutorials/photos" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="project-setup">Project Setup<a class="hash-link" href="#project-setup" title="Direct link to heading">​</a></h2><p>We will use a multi-platform library setup for this app, with a multiplatform launcher that depends on it. This is not necessary to use Doodle. You could create a single multiplatform build with the common parts of your app in <code>commonMain</code> etc.. This setup is used here because these apps are also launched by an app within <code>DocApps</code> when embedding them like below. Therefore, we need a pure library for each app. This is why there is an app and a runner.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Photos</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">PhotosRunner</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Photos/build.gradle.kts" target="_blank" rel="noopener noreferrer"><strong>build.gradle.kts</strong></a></p><code theme="darcula" mode="kotlin" data-highlight-only="true">plugins {
    kotlin(&quot;multiplatform&quot;)
}

kotlin {
    jsTargets (BOTH)
    jvmTargets()

    val doodleVersion    : String by project
    val coroutinesVersion: String by project

    sourceSets {
        val commonMain by getting {
            dependencies {
                implementation(kotlin(&quot;stdlib-common&quot;))
                api(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:$coroutinesVersion&quot;)

                api(&quot;io.nacular.doodle:core:$doodleVersion&quot;)
                api(&quot;io.nacular.doodle:controls:$doodleVersion&quot;)
                api(&quot;io.nacular.doodle:animation:$doodleVersion&quot;)
                api(&quot;io.nacular.doodle:themes:$doodleVersion&quot;)
            }
        }
    }
}</code></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/PhotosRunner/build.gradle.kts" target="_blank" rel="noopener noreferrer"><strong>build.gradle.kts</strong></a></p><code theme="darcula" mode="kotlin" data-highlight-only="true">plugins {
    kotlin(&quot;multiplatform&quot;)
    application
}

kotlin {
    js(IR) {
        browser()
        binaries.executable()
    }

    jvm {
        withJava()
        compilations.all {
            kotlinOptions {
                jvmTarget = &quot;11&quot;
            }
        }
    }

    val doodleVersion: String by project

    sourceSets {
        val commonMain by getting {
            dependencies {
                implementation(project(&quot;:Photos&quot;))
            }
        }

        val jsMain by getting {
            dependencies {
                implementation (&quot;io.nacular.doodle:browser:$doodleVersion&quot;)
            }
        }

        val jvmMain by getting {
            dependencies {
                val osName = System.getProperty(&quot;os.name&quot;)
                val targetOs = when {
                    osName == &quot;Mac OS X&quot;       -&gt; &quot;macos&quot;
                    osName.startsWith(&quot;Win&quot;  ) -&gt; &quot;windows&quot;
                    osName.startsWith(&quot;Linux&quot;) -&gt; &quot;linux&quot;
                    else                       -&gt; error(&quot;Unsupported OS: $osName&quot;)
                }

                val targetArch = when (val osArch = System.getProperty(&quot;os.arch&quot;)) {
                    &quot;x86_64&quot;, &quot;amd64&quot; -&gt; &quot;x64&quot;
                    &quot;aarch64&quot;         -&gt; &quot;arm64&quot;
                    else              -&gt; error(&quot;Unsupported arch: $osArch&quot;)
                }

                val target = &quot;${targetOs}-${targetArch}&quot;

                implementation (&quot;io.nacular.doodle:desktop-jvm-$target:$doodleVersion&quot;)
            }
        }
    }
}

application {
    mainClass.set(&quot;io.nacular.doodle.examples.MainKt&quot;)
}

installFullScreenDemo(&quot;Development&quot;)
installFullScreenDemo(&quot;Production&quot; )</code></div></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-application">The Application<a class="hash-link" href="#the-application" title="Direct link to heading">​</a></h2><p>All Doodle apps must implement the <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer"><code>Application</code></a> interface. The framework will then initialize our app via the constructor.</p><p>The app&#x27;s structure is fairly simple. It has a main Container that holds the images and supports drag-drop, and a panel with controls for manipulating a selected image.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Photos/src/commonMain/kotlin/io/nacular/doodle/examples/PhotosApp.kt#L11" target="_blank" rel="noopener noreferrer"><strong>PhotosApp.kt</strong></a></p><code theme="darcula" mode="kotlin" data-highlight-only="true">
class PhotosApp(/*...*/): Application {
    init {
        // ...


        val panelToggle                 // Button used to show/hide the panel
        val panel                       // Has controls for manipulating images
        val mainContainer = container { // container that holds images
            // ...


            dropReceiver = object: DropReceiver {
                // support drag-drop importing
            }


            GlobalScope.launch {
                listOf(&quot;tetons.jpg&quot;, &quot;earth.jpg&quot;).forEachIndexed { index, file -&gt;
                    // load default images
                }
            }
        }


        display += listOf(mainContainer, panel, panelToggle)


        // ...
    }


    override fun shutdown() {}
}
</code><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Notice that <code>shutdown</code> is a no-op, since we don&#x27;t have any cleanup to do when the app closes.</p></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="creating-a-full-screen-app">Creating A Full Screen App<a class="hash-link" href="#creating-a-full-screen-app" title="Direct link to heading">​</a></h2><p>Doodle apps can be <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer">launched</a> in a few different ways. We create a helper to launch the app in <a href="https://nacular.github.io/doodle/docs/applications#top-level-apps" target="_blank" rel="noopener noreferrer">full screen</a>.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Photos/src/main/kotlin/io/nacular/doodle/examples/FullScreen.kt#L22" target="_blank" rel="noopener noreferrer"><strong>FullScreen.kt</strong></a></p><code theme="darcula" mode="kotlin" data-highlight-only="true">package io.nacular.doodle.examples

import io.nacular.doodle.animation.Animator
import io.nacular.doodle.animation.AnimatorImpl
import io.nacular.doodle.application.Modules.Companion.DragDropModule
import io.nacular.doodle.application.Modules.Companion.FocusModule
import io.nacular.doodle.application.Modules.Companion.KeyboardModule
import io.nacular.doodle.application.application
import io.nacular.doodle.image.ImageLoader
import io.nacular.doodle.image.impl.ImageLoaderImpl
import io.nacular.doodle.theme.basic.BasicTheme
import io.nacular.doodle.theme.native.NativeTheme.Companion.nativeTextFieldBehavior
import org.kodein.di.DI.Module
import org.kodein.di.bindSingleton
import org.kodein.di.instance

/**
 * Creates a [PhotosApp]
 */
//sampleStart
fun main() {
    application(modules = listOf(
        FocusModule,
        KeyboardModule,
        DragDropModule,
        BasicTheme.basicLabelBehavior(),
        nativeTextFieldBehavior(spellCheck = false),
        BasicTheme.basicMutableSpinnerBehavior(),
        BasicTheme.basicCircularProgressIndicatorBehavior(thickness = 18.0),
        Module(name = &quot;AppModule&quot;) {
            bindSingleton&lt;Animator&gt;    { AnimatorImpl   (instance(), instance()) }
            bindSingleton&lt;ImageLoader&gt; { ImageLoaderImpl(instance(), instance()) }
        }
    )) {
        // load app
        PhotosApp(
            theme        = instance(),
            images       = instance(),
            display      = instance(),
            animate      = instance(),
            themeManager = instance(),
            focusManager = instance()
        )
    }
}
//sampleEnd</code><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Normally this would just be your <code>main</code> function. But <code>main</code> would prevent the app from being used as a library. Which is what happens to allow both an embedded (in the docs) and full-screen version.</p></div></div><p>The <code>application</code> function launches apps. It takes a list of modules, and a lambda that builds the
app. This lambda is within a Kodein injection context, which means we can inject dependencies into our app via
<code>instance</code>, <code>provider</code>, etc.</p><p>Notice that we have included several modules for our app. This includes one for focus, keyboard, drag-drop and several for various View <a href="https://nacular.github.io/doodle/docs/rendering/behaviors" target="_blank" rel="noopener noreferrer"><code>Behaviors</code></a> (i.e. <a href="https://nacular.github.io/doodle-api/browser/io.nacular.doodle.theme.native/-native-theme/-companion/native-text-field-behavior.html" target="_blank" rel="noopener noreferrer"><code>nativeTextFieldBehavior()</code></a>) which loads the native behavior for TextFields. We also define some bindings directly in a new module. These are items with no built-in module, or items that only exist in our app code.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Check out Kodein to learn more about how it handles dependency injection.</p></div></div><p>The <code>application</code> function also takes an optional HTML element within which the app will be hosted. The app will be hosted in <code>document.body</code> if you do not specify an element.</p><p>App launching is the only part of our code that is platform-specific; since it is the only time we might care about an HTML element. It also helps support embedding apps into non-Doodle contexts.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="drag-drop-support">Drag-drop Support<a class="hash-link" href="#drag-drop-support" title="Direct link to heading">​</a></h2><p>Drag-drop support requires the <a href="https://nacular.github.io/doodle/docs/dragdrop" target="_blank" rel="noopener noreferrer"><code>DragDropModule</code></a> to work. It then requires setting up drag/drop recognizers on the source/target Views. We created the <code>mainContainer</code> for this. You can see that the <code>dropReceiver</code> property is set to a <code>DropReceiver</code> that controls how the <code>mainContainer</code> handles drop events.</p><code theme="darcula" mode="kotlin" data-highlight-only="true">
class PhotosApp(/*...*/ private val images: ImageLoader /*...*/): Application {
    init {
        // ...
        val mainContainer = container {
            // ...


            dropReceiver = object: DropReceiver {
                private  val allowedFileTypes                    = Files(ImageType(&quot;jpg&quot;), ImageType(&quot;jpeg&quot;), ImageType(&quot;png&quot;))
                override val active                              = true
                private  fun allowed          (event: DropEvent) = allowedFileTypes in event.bundle
                override fun dropEnter        (event: DropEvent) = allowed(event)
                override fun dropOver         (event: DropEvent) = allowed(event)
                override fun dropActionChanged(event: DropEvent) = allowed(event)
                override fun drop             (event: DropEvent) = event.bundle[allowedFileTypes]?.let { files -&gt;
                    val photos = files.map { GlobalScope.async { images.load(it)?.let { FixedAspectPhoto(it) } } }


                    GlobalScope.launch {
                        photos.mapNotNull { it.await() }.forEach { photo -&gt;
                            import(photo, event.location)
                        }
                    }
                    true
                } ?: false
            }
        }
    }


    // ...
}
</code><p>Our <code>DropReceiver</code> specifies the supported file-types (jpg, jpeg, and png). It then checks that any drop event contains valid files before accepting it. The <code>drop(event: DropEvent)</code> method is called when the user attempts the final drop. Here, the receiver fetches all the allowed files in the bundle, and tries to load and import each one. Notice that the receiver converts raw Image returned by <code>ImageLoader</code> into a <code>FixedAspectPhoto</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="importing-an-image">Importing An Image<a class="hash-link" href="#importing-an-image" title="Direct link to heading">​</a></h2><p>We import images using a local <code>import</code> function inside the <code>mainContainer</code> creation block. This simplifies access to local state. The <code>import</code> function takes a photo, which is a <code>View</code>, and a location to place it.</p><code theme="darcula" mode="kotlin" data-highlight-only="true">
val import = { photo: View, location: Point -&gt;


}
</code><p>Import resizes and centers the photo at the given point. It is center-rotates it between -15° and 15°. Finally, a listener is added to the <code>pressed</code> pointer event. This moves the photo to the foreground and updates the panel.</p><code theme="darcula" mode="kotlin" data-highlight-only="true">
photo.width           = 400.0
photo.position        = location - Point(photo.width / 2, photo.height / 2)
photo.transform       = Identity.rotate(location, (Random.nextFloat() * 30 - 15) * degrees)
photo.pointerChanged += pressed {
    children.move(photo, to = children.size - 1)
    panel.setPhoto(photo)
}
</code><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-gestures">Using Gestures<a class="hash-link" href="#using-gestures" title="Direct link to heading">​</a></h2><p>Import also registers a custom gesture listener to support multi-touch scaling and rotations.</p><code theme="darcula" mode="kotlin" data-highlight-only="true">
GestureRecognizer(photo).changed += object: GestureListener&lt;GestureEvent&gt; {
    // ...


    override fun started(event: GestureEvent) {
        // capture initial state
        event.consume()
    }


    override fun changed(event: GestureEvent) {
        // 1) calculate rotation angle
        // 2) update photo transform to include rotation
        // 3) update photo bounds based on scaling
        event.consume()
    }


    override fun ended(event: GestureEvent) {
        // simply consume event
        event.consume()
    }
}
</code><p><code>GestureRecognizer</code> takes a <code>View</code> and emits events whenever it detects motion from 2 or more pointers in that <code>View</code>. It also calculates a scale value by comparing the distance between the selected pointers over time.</p><p>We register a listener that uses the events to update the photo&#x27;s <code>transform</code> and <code>bounds</code>. The listener also consumes events to avoid them making it to subsequent pointer listeners (the <code>Resizer</code> used for single pointer manipulation in this case).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="capturing-initial-gesture-state">Capturing Initial Gesture State<a class="hash-link" href="#capturing-initial-gesture-state" title="Direct link to heading">​</a></h3><p>We record the state of our photo, and the pointers provided by the <code>GestureRecognizer</code> on the <code>started</code> event. Notice that <code>GestureRecognizer</code> provides locations in the photo&#x27;s local coordinate. This makes sense for a general-purpose utility and matches the way Doodle reports pointer events. We use these values to modify the photo&#x27;s bounds though, which is defined in its parent&#x27;s coordinates. So we map the points into the parent before our calculations.</p><code theme="darcula" mode="kotlin" data-highlight-only="true">
override fun started(event: GestureEvent) {
    // Capture initial state to apply deltas with in `changed`
    originalSize     = photo.size
    originalCenter   = this@container.toLocal(event.center, photo)
    originalVector   = event.initial[1].inParent(photo) - event.initial[0].inParent(photo)
    originalPosition = photo.position
    initialTransform = photo.transform


    event.consume() // ensure event is consumed from Resizer
}
</code><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="handling-gesture-updates">Handling Gesture Updates<a class="hash-link" href="#handling-gesture-updates" title="Direct link to heading">​</a></h3><p>The values recorded in <code>started</code> are used--along with the new state--in the <code>changed</code> event to update the selected photo.</p><code theme="darcula" mode="kotlin" data-highlight-only="true">
override fun changed(event: GestureEvent) {
    val currentVector = event.current[1].inParent(photo) - event.current[0].inParent(photo)


    // Angle between initial set of points and their current locations
    val transformAngle = atan2(
        originalVector.x * currentVector.y - originalVector.y * currentVector.x,
        originalVector.x * currentVector.x + originalVector.y * currentVector.y
    )


    // Use transform for rotation
    photo.transform = initialTransform.rotate(around = originalCenter, by = transformAngle)


    // Update bounds instead of scale transformation
    photo.bounds = Rectangle(
            originalPosition - ((originalPosition - originalCenter) * (1 - event.scale)),
            originalSize * event.scale)


    event.consume() // ensure event is consumed from Resizer
}
</code></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/doodle-tutorials/docs/todo"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Todo</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doodle-tutorials/docs/photostream"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Photo Stream</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-setup" class="table-of-contents__link toc-highlight">Project Setup</a></li><li><a href="#the-application" class="table-of-contents__link toc-highlight">The Application</a></li><li><a href="#creating-a-full-screen-app" class="table-of-contents__link toc-highlight">Creating A Full Screen App</a></li><li><a href="#drag-drop-support" class="table-of-contents__link toc-highlight">Drag-drop Support</a></li><li><a href="#importing-an-image" class="table-of-contents__link toc-highlight">Importing An Image</a></li><li><a href="#using-gestures" class="table-of-contents__link toc-highlight">Using Gestures</a><ul><li><a href="#capturing-initial-gesture-state" class="table-of-contents__link toc-highlight">Capturing Initial Gesture State</a></li><li><a href="#handling-gesture-updates" class="table-of-contents__link toc-highlight">Handling Gesture Updates</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"></div></footer></div>
<script src="/doodle-tutorials/assets/js/runtime~main.e6059f2d.js"></script>
<script src="/doodle-tutorials/assets/js/main.1f062b3e.js"></script>
</body>
</html>